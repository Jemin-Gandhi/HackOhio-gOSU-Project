<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gOSU - Campus Navigator</title>
    <!-- Link to the external CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <h1>gOSU - Campus Navigator</h1>
        <form>
            <label for="location-input">Choose a building:</label>
            <input list="location" id="location-input" name="location" placeholder="Start typing...">
            <datalist id="location">
                <option value="Dreese Lab">
                <option value="Raney House">
                <option value="Ohio Union">
                <option value="Animal Science Building">
            </datalist>
            <button type="button" onclick="getRoute()">Get Route</button>
        </form>

        <div class="info-display">
            <h2>Shortest Route:</h2>
            <p id="route-display">Route will be displayed here.</p>
        </div>

        <div class="info-display">
            <h2>Bus Capacity:</h2>
            <p id="people-count">__ % full, __ spots left</p>
        </div>

        <div id="overCapacity" class="hidden">OVER CAPACITY</div>
    </div>

    <script>
        function updateSerialData() {
            fetch('/api/message')
                .then(response => response.json())
                .then(data => {
                    // Update bus capacity and handle over-capacity
                    let spotsLeftText;
                    if (data.spots_left < 0) {
                        spotsLeftText = `Over capacity by ${Math.abs(data.spots_left)} spots`;
                    } else {
                        spotsLeftText = `${data.percentage_full} % full, ${data.spots_left} spots left`;
                    }
                    document.getElementById('people-count').innerText = spotsLeftText;

                    // Show or hide the OVER CAPACITY message
                    if (data.over_capacity) {
                        document.getElementById('overCapacity').classList.remove('hidden');
                    } else {
                        document.getElementById('overCapacity').classList.add('hidden');
                    }
                })
                .catch(error => {
                    document.getElementById('serialData').innerText = 'Error: ' + error;
                });
        }

        // Update serial data every 1/2 second
        setInterval(updateSerialData, 500);

        function getRoute() {
            const building = document.getElementById('location-input').value;
            // Your logic for fetching and displaying the route goes here
            document.getElementById('route-display').innerText = `Calculating the route to ${building}...`;
        }
    </script>
</body>
</html>
